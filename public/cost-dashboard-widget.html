<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QEW Cost Dashboard</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #1e1e1e;
      color: #00ff00;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #00ffff;
      font-size: 28px;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }
    .gauge {
      width: 100%;
      max-width: 600px;
      margin: 30px auto;
    }
    .gauge-label {
      color: #00ffff;
      font-size: 16px;
      margin-bottom: 10px;
      text-align: center;
    }
    .gauge-bar {
      width: 100%;
      height: 40px;
      background: #333;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid #00ff00;
    }
    .gauge-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ff00, #ffff00, #ff9900, #ff0000);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: #fff;
      font-weight: bold;
      font-size: 14px;
    }
    .gauge-info {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 14px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .stat {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #333;
      transition: border-color 0.3s;
    }
    .stat:hover {
      border-color: #00ffff;
    }
    .stat-label {
      color: #00ffff;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .stat-value {
      color: #00ff00;
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-detail {
      color: #888;
      font-size: 12px;
    }
    .status {
      text-align: center;
      padding: 20px;
      margin: 30px 0;
      border-radius: 10px;
      font-size: 24px;
      font-weight: bold;
    }
    .status-safe { background: #1a3a1a; color: #00ff00; border: 2px solid #00ff00; }
    .status-info { background: #3a3a1a; color: #ffff00; border: 2px solid #ffff00; }
    .status-caution { background: #3a2a1a; color: #ff9900; border: 2px solid #ff9900; }
    .status-warning { background: #3a1a1a; color: #ff0000; border: 2px solid #ff0000; }
    .status-critical { background: #3a0000; color: #ff0000; border: 2px solid #ff0000; animation: blink 1s infinite; }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      25%, 75% { opacity: 0.5; }
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    button {
      background: #00ff00;
      color: #1e1e1e;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
      transition: background 0.3s;
    }
    button:hover {
      background: #00ffff;
    }
    button.danger {
      background: #ff0000;
      color: #fff;
    }
    button.danger:hover {
      background: #cc0000;
    }
    .demo-mode {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 10px;
      margin: 30px 0;
      border: 2px solid #00ffff;
    }
    .demo-mode h2 {
      color: #00ffff;
      margin-top: 0;
    }
    .mode-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .mode-button {
      flex: 1;
      padding: 15px;
      background: #1e1e1e;
      border: 2px solid #333;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .mode-button:hover {
      border-color: #00ffff;
    }
    .mode-button.active {
      border-color: #00ff00;
      background: #1a3a1a;
    }
    .mode-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .mode-name {
      color: #00ffff;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .mode-cost {
      color: #ffff00;
      font-size: 12px;
    }
    .last-updated {
      text-align: center;
      color: #666;
      font-size: 12px;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí∞ QEW COST DASHBOARD</h1>
    <p class="subtitle">Real-time monitoring of Gemini API usage and costs</p>

    <div class="status" id="mainStatus">
      ‚úÖ SAFE - Well within budget limits
    </div>

    <div class="gauge">
      <div class="gauge-label">Monthly Budget Usage</div>
      <div class="gauge-bar">
        <div class="gauge-fill" id="budgetGauge">0%</div>
      </div>
      <div class="gauge-info">
        <span id="budgetUsed">$0.00</span>
        <span id="budgetRemaining">$3.00 remaining</span>
      </div>
    </div>

    <div class="stats">
      <div class="stat">
        <div class="stat-label">üìÖ Daily Requests</div>
        <div class="stat-value" id="dailyRequests">0</div>
        <div class="stat-detail" id="dailyLimit">of 50 limit (0% used)</div>
      </div>
      <div class="stat">
        <div class="stat-label">üìä Monthly Requests</div>
        <div class="stat-value" id="monthlyRequests">0</div>
        <div class="stat-detail" id="monthlyLimit">of 400 limit (0% used)</div>
      </div>
      <div class="stat">
        <div class="stat-label">üíµ Current Month Cost</div>
        <div class="stat-value" id="currentCost">$0.0000</div>
        <div class="stat-detail">of $3.00 budget</div>
      </div>
      <div class="stat">
        <div class="stat-label">üí∞ Budget Remaining</div>
        <div class="stat-value" id="budgetRemainingValue">$3.00</div>
        <div class="stat-detail" id="budgetPercent">100% available</div>
      </div>
    </div>

    <div class="demo-mode">
      <h2>üéØ Demo Mode</h2>
      <p>Control API usage by switching between demo modes:</p>
      <div class="mode-buttons">
        <div class="mode-button" data-mode="cached" onclick="switchMode('cached')">
          <div class="mode-icon">üíæ</div>
          <div class="mode-name">CACHED</div>
          <div class="mode-cost">$0.00 - Zero cost</div>
        </div>
        <div class="mode-button" data-mode="live" onclick="switchMode('live')">
          <div class="mode-icon">üé•</div>
          <div class="mode-name">LIVE</div>
          <div class="mode-cost">~$0.0002 per camera</div>
        </div>
        <div class="mode-button" data-mode="full" onclick="switchMode('full')">
          <div class="mode-icon">üöÄ</div>
          <div class="mode-name">FULL</div>
          <div class="mode-cost">~$0.004 per run</div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button onclick="refreshStats()">üîÑ Refresh</button>
      <button onclick="printReport()">üìä Print Report</button>
      <button onclick="exportStats()">üíæ Export CSV</button>
      <button class="danger" onclick="resetStats()">‚ö†Ô∏è Reset Stats (Admin)</button>
    </div>

    <p class="last-updated" id="lastUpdated">Last updated: --</p>
  </div>

  <script type="module">
    function loadStats() {
      const stats = JSON.parse(localStorage.getItem('qew_api_usage_stats') || '{}');

      const dailyRequests = stats.dailyRequests || 0;
      const monthlyRequests = stats.monthlyRequests || 0;
      const costPerRequest = 0.000075;
      const monthlyBudget = 3.00;

      const currentCost = monthlyRequests * costPerRequest;
      const budgetUsed = (currentCost / monthlyBudget * 100);
      const budgetRemaining = monthlyBudget - currentCost;

      // Daily stats
      const dailyPercent = (dailyRequests / 50 * 100).toFixed(1);
      document.getElementById('dailyRequests').textContent = dailyRequests;
      document.getElementById('dailyLimit').textContent = `of 50 limit (${dailyPercent}% used)`;

      // Monthly stats
      const monthlyPercent = (monthlyRequests / 400 * 100).toFixed(1);
      document.getElementById('monthlyRequests').textContent = monthlyRequests;
      document.getElementById('monthlyLimit').textContent = `of 400 limit (${monthlyPercent}% used)`;

      // Cost stats
      document.getElementById('currentCost').textContent = `$${currentCost.toFixed(4)}`;
      document.getElementById('budgetRemainingValue').textContent = `$${budgetRemaining.toFixed(4)}`;
      document.getElementById('budgetPercent').textContent = `${(100 - budgetUsed).toFixed(1)}% available`;

      // Budget gauge
      const gauge = document.getElementById('budgetGauge');
      const gaugeWidth = Math.min(budgetUsed, 100);
      gauge.style.width = `${gaugeWidth}%`;
      gauge.textContent = `${budgetUsed.toFixed(1)}%`;

      document.getElementById('budgetUsed').textContent = `$${currentCost.toFixed(4)} used`;
      document.getElementById('budgetRemaining').textContent = `$${budgetRemaining.toFixed(4)} remaining`;

      // Main status
      const statusEl = document.getElementById('mainStatus');
      if (budgetUsed < 25) {
        statusEl.className = 'status status-safe';
        statusEl.textContent = '‚úÖ SAFE - Well within budget limits';
      } else if (budgetUsed < 50) {
        statusEl.className = 'status status-info';
        statusEl.textContent = 'üü° MONITOR - Usage is increasing, keep an eye on it';
      } else if (budgetUsed < 75) {
        statusEl.className = 'status status-caution';
        statusEl.textContent = 'üü† CAUTION - Approaching budget limit, reduce API calls';
      } else if (budgetUsed < 90) {
        statusEl.className = 'status status-warning';
        statusEl.textContent = 'üî¥ WARNING - Near budget limit, switch to CACHED mode';
      } else {
        statusEl.className = 'status status-critical';
        statusEl.textContent = 'üö® CRITICAL - Budget limit reached! STOP API CALLS';
      }

      // Demo mode
      const currentMode = localStorage.getItem('qew_demo_mode') || 'cached';
      document.querySelectorAll('.mode-button').forEach(btn => {
        if (btn.dataset.mode === currentMode) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      // Last updated
      document.getElementById('lastUpdated').textContent =
        `Last updated: ${new Date().toLocaleString()}`;
    }

    window.switchMode = function(mode) {
      localStorage.setItem('qew_demo_mode', mode);
      console.log(`[Demo Mode] Switched to: ${mode.toUpperCase()}`);
      loadStats();
    };

    window.refreshStats = function() {
      loadStats();
      console.log('[Cost Dashboard] Stats refreshed');
    };

    window.printReport = function() {
      const stats = JSON.parse(localStorage.getItem('qew_api_usage_stats') || '{}');
      const dailyRequests = stats.dailyRequests || 0;
      const monthlyRequests = stats.monthlyRequests || 0;
      const costPerRequest = 0.000075;
      const currentCost = monthlyRequests * costPerRequest;

      console.log('\n' + '='.repeat(60));
      console.log('üí∞ QEW COST PROTECTION - USAGE REPORT');
      console.log('='.repeat(60));
      console.log(`Date: ${new Date().toLocaleString()}`);
      console.log('');
      console.log('DAILY USAGE:');
      console.log(`  Requests: ${dailyRequests} / 50`);
      console.log(`  Remaining: ${50 - dailyRequests} requests`);
      console.log('');
      console.log('MONTHLY USAGE:');
      console.log(`  Requests: ${monthlyRequests} / 400`);
      console.log(`  Remaining: ${400 - monthlyRequests} requests`);
      console.log(`  Cost: $${currentCost.toFixed(4)} / $3.00`);
      console.log(`  Budget Remaining: $${(3.00 - currentCost).toFixed(4)}`);
      console.log('='.repeat(60) + '\n');
    };

    window.exportStats = function() {
      const stats = JSON.parse(localStorage.getItem('qew_api_usage_stats') || '{}');
      const dailyRequests = stats.dailyRequests || 0;
      const monthlyRequests = stats.monthlyRequests || 0;
      const costPerRequest = 0.000075;
      const currentCost = monthlyRequests * costPerRequest;

      const csv = [
        'Metric,Value',
        `Date,${new Date().toISOString()}`,
        `Daily Requests,${dailyRequests}`,
        `Daily Limit,50`,
        `Monthly Requests,${monthlyRequests}`,
        `Monthly Limit,400`,
        `Current Cost,$${currentCost.toFixed(4)}`,
        `Monthly Budget,$3.00`,
        `Budget Remaining,$${(3.00 - currentCost).toFixed(4)}`,
        `Budget Used %,${(currentCost / 3.00 * 100).toFixed(2)}%`
      ].join('\n');

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `qew-cost-report-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);

      console.log('‚úÖ Cost report exported to CSV');
    };

    window.resetStats = function() {
      if (!confirm('‚ö†Ô∏è Are you sure you want to reset all usage statistics? This is for admin use only.')) {
        return;
      }

      localStorage.setItem('qew_api_usage_stats', JSON.stringify({
        dailyRequests: 0,
        monthlyRequests: 0,
        lastResetDate: new Date().toISOString().split('T')[0],
        monthlyResetDate: new Date().toISOString().slice(0, 7),
        lastUpdated: new Date().toISOString()
      }));

      console.log('‚ö†Ô∏è Usage statistics reset');
      loadStats();
    };

    // Load stats on page load
    loadStats();

    // Auto-refresh every 5 seconds
    setInterval(loadStats, 5000);
  </script>
</body>
</html>
